# Processing pipeline for an experiment with 5 visual stimuli
A set of notebooks customized for a numerosity experiment with 4 visual stimuli : 1, 2, 3, 4 and 5 dots on the screen , separated by a blank screen.

Requires numan version 1.0.4, and vodex version 1.0.18
upgrade the packages if you have older versions with :
```
pip install --upgrade vodex
pip install --upgrade numan
```
Or, even better, create a new virtual enviroment and install numan there.
If you are using conda:
```
conda create -n numan python=3.10
conda activate numan
pip install numan==1.0.4
```
This should install everything you need (it will get vodex and any other packages).


Run these notebooks in order, read the comments :)

Notebooks 01, 02, 03 do the preprocessing and take a pretty long time to run .. the rest of the notebooks produces nice plots and cell masks. 
Notebook 07 explores the effect of the covariates.

Will create the following file structure :

```
processed                                              
│   experiment_raw.db <----------------------------------- the file that contains everything about the experiment, you are creating it once and will be reusing ever after
│   experiment_dff.db <------------------------------- everything about the experiment, but loads from the dff movie, not from the raw data                   ++
└───dff_movie  <---------------------------------------- the dff movie :)
│   │   dff_movie_0000.tif                              
│   │   dff_movie_0001.tif                              
│   │   ...                                             
│
└───tscore_volumes  <----------------------------------- SPM tif files
│   │   tscore_SvB_max.tif <-------------------------------- t-score image for Stimuli vs Blank
└───spots
│   └───imaris  <--------------------------------------- ATTENTION : Using Imaris to group the regions of similar SPM scores together. 
│       │   │                                                        You need to put files generated by imaris into this folder!!!
│       │   └───tscore_SvB_max_Statistics
│       │       │     tscore_SvB_Position.csv
│       │       │     tscore_SvB_Diameter.csv
│       │       │     ...
│   └───signals  <-------------------------------------- json files with the extracted signals, also will have the group information after you add it
│       │   spots_SvB_max.json
│   └───reports  <---------------------------------- tiffs and pdf with the cells significant in any pairwise comparison
│       └───all_significant  <---------------------- tiffs and pdf with all significant in any way cells
│           │   └───signals  <---------------------- pdfs with signals
│           │       │     ...
│       └───groupped  <----------------------------- tiffs and pdf where the cells are groupped based on signal shape .. or anything else you want
│           │   │
│           │   └───signals  <---------------------- pdfs with signals
│           │       │     ...
│           │   └───images  <----------------------- tif masks
│           │       │     ...
```
